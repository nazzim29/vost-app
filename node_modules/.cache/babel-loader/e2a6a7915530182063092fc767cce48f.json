{"ast":null,"code":"import { createRouter, createWebHistory } from \"vue-router\";\nimport store from \"../store\";\n\nfunction loadView(view) {\n  return () => import(`../views/${view}.vue`);\n}\n\nconst routes = [{\n  path: \"/\",\n  name: \"Home\",\n  component: loadView(\"Home\"),\n  meta: {\n    auth: true\n  }\n}, {\n  path: \"/parametres\",\n  name: \"Parametres\",\n  component: loadView(\"Parametres\"),\n  meta: {\n    auth: true,\n    role: \"admin\"\n  }\n}, {\n  path: \"/login\",\n  name: \"Login\",\n  component: loadView(\"user/Login\"),\n  meta: {\n    auth: false\n  }\n}, {\n  path: \"/user\",\n  name: \"User\",\n  component: loadView(\"user/UsersIndex\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-utilisateur\"\n  }\n}, // {\n// \tpath: \"/user/new\",\n// \tname: \"NewUser\",\n// \tcomponent: loadView(\"user/NewUser\"),\n// \tmeta: {\n// \t\tauth: true,\n// \t}\n// },\n// {\n// \tpath: \"/user/:id\",\n// \tname: \"UserProfile\",\n// \tcomponent: loadView(\"user/UsersIndex\"),\n// \tmeta: {\n// \t\tauth:true,\n// \t}\n// },\n// {\n// \tpath: \"/user/edit/:id\",\n// \tname: \"UserEdit\",\n// \tcomponent: loadView(\"user/NewUser\"),\n// \tmeta: {\n// \t\tauth: true,\n// \t}\n// },\n// {\n// \tpath: \"/me\",\n// \tname: \"Profile\",\n// \tcomponent: loadView(\"user/Profile\"),\n// \tmeta: {\n// \t\tauth: true,\n// \t}\n// },\n{\n  path: \"/fonction\",\n  name: \"Fonction\",\n  component: loadView(\"user/Fonction\"),\n  meta: {\n    auth: true,\n    role: \"admin\"\n  }\n}, {\n  path: \"/commandes\",\n  name: \"Commandes\",\n  component: loadView(\"commandes/Commandes\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-commande\"\n  }\n}, {\n  path: \"/commandes/:id\",\n  name: \"Commande\",\n  component: loadView(\"commandes/CommandeShow\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-commande\"\n  }\n}, {\n  path: \"/produits\",\n  name: \"Produits\",\n  component: loadView(\"produits/Produits\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-produit\"\n  }\n}, {\n  path: \"/productions\",\n  name: \"Productions\",\n  component: loadView(\"produits/Productions\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-production\"\n  }\n}, {\n  path: \"/MatierePremiere\",\n  name: \"MatierePremiere\",\n  component: loadView(\"produits/MatierePremiere\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-matiere\"\n  }\n}, // {\n// \tpath: \"/Formules\",\n// \tname: \"Formules\",\n// \tcomponent: loadView(\"produits/Formules\"),\n// \tmeta: {\n// \t\tauth: true,\n// \t}\n// },\n// {\n// \tpath: \"/messagerie\",\n// \tname: \"messagerie\",\n// \tcomponent: loadView(\"Messagerie\"),\n// \tmeta: {\n// \t\tauth: true,\n// \t}\n// },\n{\n  path: \"/contact-client\",\n  name: \"ContactClient\",\n  component: loadView(\"client/ContactClient\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-contactclient\"\n  }\n}, {\n  path: \"/Ventes/:id\",\n  name: \"Vente\",\n  component: loadView(\"vente/VenteShow\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-vente\"\n  }\n}, {\n  path: \"/Ventes\",\n  name: \"Ventes\",\n  component: loadView(\"vente/Ventes\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-vente\"\n  }\n}, {\n  path: \"/clients\",\n  name: \"Clients\",\n  component: loadView(\"client/Client\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-client\"\n  }\n}, {\n  path: \"/clients/:id\",\n  name: \"ClientShow\",\n  component: loadView(\"client/ClientShow\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-client\"\n  }\n}, {\n  path: \"/paiements\",\n  name: \"Paiements\",\n  component: loadView(\"paiement/index\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-paiement\"\n  }\n}];\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\nlet interval = null;\n\nasync function checklogin() {\n  if (store.getters.isAuth) {\n    if (!interval) {\n      interval = setInterval(async () => {\n        await store.dispatch(\"checkAuth\");\n      }, 5000);\n    }\n\n    return true;\n  } else {\n    return false;\n  }\n}\n\nrouter.beforeEach(async function (to, from, next) {\n  console.log();\n  let isLogged = await checklogin(); //if to.auth is true and user is not logged in\n\n  if (to.meta.auth && !isLogged) {\n    console.log(\"not logged in\");\n    return next({\n      name: \"Login\"\n    });\n  } else if (to.meta.auth && isLogged) {\n    console.log(\"logged in\");\n\n    if (to.meta.role) {\n      if (store.getters.getCurrentUser.Profile.nom === to.meta.role) {\n        return next();\n      } else {\n        console.log(\"not authorized (role)\");\n        return next(\"/\");\n      }\n    } else if (to.meta.autorisation) {\n      if (store.getters.getCurrentUser.Profile.Autorisations.find(el => el.nom == to.meta.autorisation)) {\n        return next();\n      } else {\n        console.log(\"not authorized (autorisation)\");\n        return next(\"/\");\n      }\n    }\n  }\n\n  return next(); // if (\n  // \tto.meta.auth === true\n  // ) {\n  // \tif (isLogged && (to.meta.role == store.getters.getCurrentUser.Profile.nom ||\n  // \t\tstore.getters.getCurrentUser.Profile.Autorisations.find(\n  // \t\t\t(el) => el.nom == to.meta.autorisation\n  // \t\t))) next();\n  // \telse next(\"/\");\n  // } else if (to.meta.auth === false) {\n  // \tif (isLogged) next(from);\n  // \telse next();\n  // }\n});\nexport default function (app) {\n  app.router = router;\n  app.use(router);\n}","map":{"version":3,"sources":["C:/Users/Dell/Desktop/vost-app/src/router/index.js"],"names":["createRouter","createWebHistory","store","loadView","view","routes","path","name","component","meta","auth","role","autorisation","router","history","process","env","BASE_URL","interval","checklogin","getters","isAuth","setInterval","dispatch","beforeEach","to","from","next","console","log","isLogged","getCurrentUser","Profile","nom","Autorisations","find","el","app","use"],"mappings":"AAAA,SAASA,YAAT,EAAuBC,gBAAvB,QAA+C,YAA/C;AACA,OAAOC,KAAP,MAAkB,UAAlB;;AAEA,SAASC,QAAT,CAAkBC,IAAlB,EAAwB;AACtB,SAAO,MAAM,OAAQ,YAAWA,IAAK,MAAxB,CAAb;AACD;;AAED,MAAMC,MAAM,GAAG,CACb;AACEC,EAAAA,IAAI,EAAE,GADR;AAEEC,EAAAA,IAAI,EAAE,MAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,MAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE;AADF;AAJR,CADa,EASb;AACEJ,EAAAA,IAAI,EAAE,aADR;AAEEC,EAAAA,IAAI,EAAE,YAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,YAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJC,IAAAA,IAAI,EAAE;AAFF;AAJR,CATa,EAkBb;AACEL,EAAAA,IAAI,EAAE,QADR;AAEEC,EAAAA,IAAI,EAAE,OAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,YAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE;AADF;AAJR,CAlBa,EA0Bb;AACEJ,EAAAA,IAAI,EAAE,OADR;AAEEC,EAAAA,IAAI,EAAE,MAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,iBAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJE,IAAAA,YAAY,EAAE;AAFV;AAJR,CA1Ba,EAmCb;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACEN,EAAAA,IAAI,EAAE,WADR;AAEEC,EAAAA,IAAI,EAAE,UAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,eAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJC,IAAAA,IAAI,EAAE;AAFF;AAJR,CApEa,EA6Eb;AACEL,EAAAA,IAAI,EAAE,YADR;AAEEC,EAAAA,IAAI,EAAE,WAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,qBAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJE,IAAAA,YAAY,EAAE;AAFV;AAJR,CA7Ea,EAsFb;AACEN,EAAAA,IAAI,EAAE,gBADR;AAEEC,EAAAA,IAAI,EAAE,UAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,wBAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJE,IAAAA,YAAY,EAAE;AAFV;AAJR,CAtFa,EA+Fb;AACEN,EAAAA,IAAI,EAAE,WADR;AAEEC,EAAAA,IAAI,EAAE,UAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,mBAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJE,IAAAA,YAAY,EAAE;AAFV;AAJR,CA/Fa,EAwGb;AACEN,EAAAA,IAAI,EAAE,cADR;AAEEC,EAAAA,IAAI,EAAE,aAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,sBAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJE,IAAAA,YAAY,EAAE;AAFV;AAJR,CAxGa,EAiHb;AACEN,EAAAA,IAAI,EAAE,kBADR;AAEEC,EAAAA,IAAI,EAAE,iBAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,0BAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJE,IAAAA,YAAY,EAAE;AAFV;AAJR,CAjHa,EA0Hb;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACEN,EAAAA,IAAI,EAAE,iBADR;AAEEC,EAAAA,IAAI,EAAE,eAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,sBAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJE,IAAAA,YAAY,EAAE;AAFV;AAJR,CA3Ia,EAoJb;AACEN,EAAAA,IAAI,EAAE,aADR;AAEEC,EAAAA,IAAI,EAAE,OAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,iBAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJE,IAAAA,YAAY,EAAE;AAFV;AAJR,CApJa,EA6Jb;AACEN,EAAAA,IAAI,EAAE,SADR;AAEEC,EAAAA,IAAI,EAAE,QAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,cAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJE,IAAAA,YAAY,EAAE;AAFV;AAJR,CA7Ja,EAsKb;AACEN,EAAAA,IAAI,EAAE,UADR;AAEEC,EAAAA,IAAI,EAAE,SAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,eAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJE,IAAAA,YAAY,EAAE;AAFV;AAJR,CAtKa,EA+Kb;AACEN,EAAAA,IAAI,EAAE,cADR;AAEEC,EAAAA,IAAI,EAAE,YAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,mBAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJE,IAAAA,YAAY,EAAE;AAFV;AAJR,CA/Ka,EAwLb;AACEN,EAAAA,IAAI,EAAE,YADR;AAEEC,EAAAA,IAAI,EAAE,WAFR;AAGEC,EAAAA,SAAS,EAAEL,QAAQ,CAAC,gBAAD,CAHrB;AAIEM,EAAAA,IAAI,EAAE;AACJC,IAAAA,IAAI,EAAE,IADF;AAEJE,IAAAA,YAAY,EAAE;AAFV;AAJR,CAxLa,CAAf;AAmMA,MAAMC,MAAM,GAAGb,YAAY,CAAC;AAC1Bc,EAAAA,OAAO,EAAEb,gBAAgB,CAACc,OAAO,CAACC,GAAR,CAAYC,QAAb,CADC;AAE1BZ,EAAAA;AAF0B,CAAD,CAA3B;AAIA,IAAIa,QAAQ,GAAG,IAAf;;AACA,eAAeC,UAAf,GAA4B;AAC1B,MAAIjB,KAAK,CAACkB,OAAN,CAAcC,MAAlB,EAA0B;AACxB,QAAI,CAACH,QAAL,EAAe;AACbA,MAAAA,QAAQ,GAAGI,WAAW,CAAC,YAAY;AACjC,cAAMpB,KAAK,CAACqB,QAAN,CAAe,WAAf,CAAN;AACD,OAFqB,EAEnB,IAFmB,CAAtB;AAGD;;AACD,WAAO,IAAP;AACD,GAPD,MAOO;AACL,WAAO,KAAP;AACD;AACF;;AACDV,MAAM,CAACW,UAAP,CAAkB,gBAAgBC,EAAhB,EAAoBC,IAApB,EAA0BC,IAA1B,EAAgC;AAChDC,EAAAA,OAAO,CAACC,GAAR;AACA,MAAIC,QAAQ,GAAG,MAAMX,UAAU,EAA/B,CAFgD,CAGhD;;AACA,MAAIM,EAAE,CAAChB,IAAH,CAAQC,IAAR,IAAgB,CAACoB,QAArB,EAA+B;AAC7BF,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACA,WAAOF,IAAI,CAAC;AACVpB,MAAAA,IAAI,EAAE;AADI,KAAD,CAAX;AAGD,GALD,MAKO,IAAIkB,EAAE,CAAChB,IAAH,CAAQC,IAAR,IAAgBoB,QAApB,EAA8B;AACnCF,IAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;;AACA,QAAIJ,EAAE,CAAChB,IAAH,CAAQE,IAAZ,EAAkB;AAChB,UAAIT,KAAK,CAACkB,OAAN,CAAcW,cAAd,CAA6BC,OAA7B,CAAqCC,GAArC,KAA6CR,EAAE,CAAChB,IAAH,CAAQE,IAAzD,EAA+D;AAC7D,eAAOgB,IAAI,EAAX;AACD,OAFD,MAEO;AACLC,QAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;AACA,eAAOF,IAAI,CAAC,GAAD,CAAX;AACD;AACF,KAPD,MAOO,IAAIF,EAAE,CAAChB,IAAH,CAAQG,YAAZ,EAA0B;AAC/B,UACEV,KAAK,CAACkB,OAAN,CAAcW,cAAd,CAA6BC,OAA7B,CAAqCE,aAArC,CAAmDC,IAAnD,CACGC,EAAD,IAAQA,EAAE,CAACH,GAAH,IAAUR,EAAE,CAAChB,IAAH,CAAQG,YAD5B,CADF,EAIE;AACA,eAAOe,IAAI,EAAX;AACD,OAND,MAMO;AACLC,QAAAA,OAAO,CAACC,GAAR,CAAY,+BAAZ;AACA,eAAOF,IAAI,CAAC,GAAD,CAAX;AACD;AACF;AACF;;AACD,SAAOA,IAAI,EAAX,CA/BgD,CAgChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD,CA5CD;AA6CA,eAAe,UAAUU,GAAV,EAAe;AAC5BA,EAAAA,GAAG,CAACxB,MAAJ,GAAaA,MAAb;AACAwB,EAAAA,GAAG,CAACC,GAAJ,CAAQzB,MAAR;AACD","sourcesContent":["import { createRouter, createWebHistory } from \"vue-router\";\r\nimport store from \"../store\";\r\n\r\nfunction loadView(view) {\r\n  return () => import(`../views/${view}.vue`);\r\n}\r\n\r\nconst routes = [\r\n  {\r\n    path: \"/\",\r\n    name: \"Home\",\r\n    component: loadView(\"Home\"),\r\n    meta: {\r\n      auth: true,\r\n    },\r\n  },\r\n  {\r\n    path: \"/parametres\",\r\n    name: \"Parametres\",\r\n    component: loadView(\"Parametres\"),\r\n    meta: {\r\n      auth: true,\r\n      role: \"admin\",\r\n    },\r\n  },\r\n  {\r\n    path: \"/login\",\r\n    name: \"Login\",\r\n    component: loadView(\"user/Login\"),\r\n    meta: {\r\n      auth: false,\r\n    },\r\n  },\r\n  {\r\n    path: \"/user\",\r\n    name: \"User\",\r\n    component: loadView(\"user/UsersIndex\"),\r\n    meta: {\r\n      auth: true,\r\n      autorisation: \"read-utilisateur\",\r\n    },\r\n  },\r\n  // {\r\n  // \tpath: \"/user/new\",\r\n  // \tname: \"NewUser\",\r\n  // \tcomponent: loadView(\"user/NewUser\"),\r\n  // \tmeta: {\r\n  // \t\tauth: true,\r\n\r\n  // \t}\r\n  // },\r\n  // {\r\n  // \tpath: \"/user/:id\",\r\n  // \tname: \"UserProfile\",\r\n  // \tcomponent: loadView(\"user/UsersIndex\"),\r\n  // \tmeta: {\r\n  // \t\tauth:true,\r\n  // \t}\r\n  // },\r\n  // {\r\n  // \tpath: \"/user/edit/:id\",\r\n  // \tname: \"UserEdit\",\r\n  // \tcomponent: loadView(\"user/NewUser\"),\r\n  // \tmeta: {\r\n  // \t\tauth: true,\r\n  // \t}\r\n  // },\r\n  // {\r\n  // \tpath: \"/me\",\r\n  // \tname: \"Profile\",\r\n  // \tcomponent: loadView(\"user/Profile\"),\r\n  // \tmeta: {\r\n  // \t\tauth: true,\r\n  // \t}\r\n  // },\r\n  {\r\n    path: \"/fonction\",\r\n    name: \"Fonction\",\r\n    component: loadView(\"user/Fonction\"),\r\n    meta: {\r\n      auth: true,\r\n      role: \"admin\",\r\n    },\r\n  },\r\n  {\r\n    path: \"/commandes\",\r\n    name: \"Commandes\",\r\n    component: loadView(\"commandes/Commandes\"),\r\n    meta: {\r\n      auth: true,\r\n      autorisation: \"read-commande\",\r\n    },\r\n  },\r\n  {\r\n    path: \"/commandes/:id\",\r\n    name: \"Commande\",\r\n    component: loadView(\"commandes/CommandeShow\"),\r\n    meta: {\r\n      auth: true,\r\n      autorisation: \"read-commande\",\r\n    },\r\n  },\r\n  {\r\n    path: \"/produits\",\r\n    name: \"Produits\",\r\n    component: loadView(\"produits/Produits\"),\r\n    meta: {\r\n      auth: true,\r\n      autorisation: \"read-produit\",\r\n    },\r\n  },\r\n  {\r\n    path: \"/productions\",\r\n    name: \"Productions\",\r\n    component: loadView(\"produits/Productions\"),\r\n    meta: {\r\n      auth: true,\r\n      autorisation: \"read-production\",\r\n    },\r\n  },\r\n  {\r\n    path: \"/MatierePremiere\",\r\n    name: \"MatierePremiere\",\r\n    component: loadView(\"produits/MatierePremiere\"),\r\n    meta: {\r\n      auth: true,\r\n      autorisation: \"read-matiere\",\r\n    },\r\n  },\r\n  // {\r\n  // \tpath: \"/Formules\",\r\n  // \tname: \"Formules\",\r\n  // \tcomponent: loadView(\"produits/Formules\"),\r\n  // \tmeta: {\r\n  // \t\tauth: true,\r\n\r\n  // \t}\r\n  // },\r\n  // {\r\n  // \tpath: \"/messagerie\",\r\n  // \tname: \"messagerie\",\r\n  // \tcomponent: loadView(\"Messagerie\"),\r\n  // \tmeta: {\r\n  // \t\tauth: true,\r\n  // \t}\r\n  // },\r\n  {\r\n    path: \"/contact-client\",\r\n    name: \"ContactClient\",\r\n    component: loadView(\"client/ContactClient\"),\r\n    meta: {\r\n      auth: true,\r\n      autorisation: \"read-contactclient\",\r\n    },\r\n  },\r\n  {\r\n    path: \"/Ventes/:id\",\r\n    name: \"Vente\",\r\n    component: loadView(\"vente/VenteShow\"),\r\n    meta: {\r\n      auth: true,\r\n      autorisation: \"read-vente\",\r\n    },\r\n  },\r\n  {\r\n    path: \"/Ventes\",\r\n    name: \"Ventes\",\r\n    component: loadView(\"vente/Ventes\"),\r\n    meta: {\r\n      auth: true,\r\n      autorisation: \"read-vente\",\r\n    },\r\n  },\r\n  {\r\n    path: \"/clients\",\r\n    name: \"Clients\",\r\n    component: loadView(\"client/Client\"),\r\n    meta: {\r\n      auth: true,\r\n      autorisation: \"read-client\",\r\n    },\r\n  },\r\n  {\r\n    path: \"/clients/:id\",\r\n    name: \"ClientShow\",\r\n    component: loadView(\"client/ClientShow\"),\r\n    meta: {\r\n      auth: true,\r\n      autorisation: \"read-client\",\r\n    },\r\n  },\r\n  {\r\n    path: \"/paiements\",\r\n    name: \"Paiements\",\r\n    component: loadView(\"paiement/index\"),\r\n    meta: {\r\n      auth: true,\r\n      autorisation: \"read-paiement\",\r\n    },\r\n  },\r\n];\r\n\r\nconst router = createRouter({\r\n  history: createWebHistory(process.env.BASE_URL),\r\n  routes,\r\n});\r\nlet interval = null;\r\nasync function checklogin() {\r\n  if (store.getters.isAuth) {\r\n    if (!interval) {\r\n      interval = setInterval(async () => {\r\n        await store.dispatch(\"checkAuth\");\r\n      }, 5000);\r\n    }\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\nrouter.beforeEach(async function (to, from, next) {\r\n  console.log();\r\n  let isLogged = await checklogin();\r\n  //if to.auth is true and user is not logged in\r\n  if (to.meta.auth && !isLogged) {\r\n    console.log(\"not logged in\");\r\n    return next({\r\n      name: \"Login\",\r\n    });\r\n  } else if (to.meta.auth && isLogged) {\r\n    console.log(\"logged in\");\r\n    if (to.meta.role) {\r\n      if (store.getters.getCurrentUser.Profile.nom === to.meta.role) {\r\n        return next();\r\n      } else {\r\n        console.log(\"not authorized (role)\");\r\n        return next(\"/\");\r\n      }\r\n    } else if (to.meta.autorisation) {\r\n      if (\r\n        store.getters.getCurrentUser.Profile.Autorisations.find(\r\n          (el) => el.nom == to.meta.autorisation\r\n        )\r\n      ) {\r\n        return next();\r\n      } else {\r\n        console.log(\"not authorized (autorisation)\");\r\n        return next(\"/\");\r\n      }\r\n    }\r\n  }\r\n  return next();\r\n  // if (\r\n  // \tto.meta.auth === true\r\n  // ) {\r\n  // \tif (isLogged && (to.meta.role == store.getters.getCurrentUser.Profile.nom ||\r\n  // \t\tstore.getters.getCurrentUser.Profile.Autorisations.find(\r\n  // \t\t\t(el) => el.nom == to.meta.autorisation\r\n  // \t\t))) next();\r\n  // \telse next(\"/\");\r\n  // } else if (to.meta.auth === false) {\r\n  // \tif (isLogged) next(from);\r\n  // \telse next();\r\n  // }\r\n});\r\nexport default function (app) {\r\n  app.router = router;\r\n  app.use(router);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}