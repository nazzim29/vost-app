{"ast":null,"code":"import { debounce } from \"lodash\";\nimport Pagination from \"@/components/Pagination\";\nimport ProductionRow from \"@/components/ProductionRow\";\nimport { Dialog, DialogOverlay, Disclosure, DisclosureButton, DisclosurePanel, TransitionChild, TransitionRoot, ListboxButton, Listbox, ListboxOptions, ListboxOption } from \"@headlessui/vue\";\nimport SearchBar from \"@/components/SearchBar\";\nimport { Icon } from \"@iconify/vue\";\nimport { FilterIcon, PlusSmIcon, MinusSmIcon } from \"@heroicons/vue/solid\";\nimport { XIcon } from \"@heroicons/vue/outline\";\nimport Modal from \"@/components/Modal\";\nexport default {\n  name: \"Productions\",\n\n  beforeMount() {\n    this.$store.dispatch(\"getProductions\");\n    this.$store.dispatch(\"getProduits\");\n  },\n\n  data() {\n    return {\n      mobileFiltersOpen: false,\n      currentPage: 1,\n      etatsel: [],\n      newProduction: {},\n      observer: null,\n      limit: 10\n    };\n  },\n\n  mounted() {\n    this.observer = new IntersectionObserver(this.infiniteScroll);\n  },\n\n  components: {\n    ListboxButton,\n    Listbox,\n    ListboxOptions,\n    ListboxOption,\n    Dialog,\n    Pagination,\n    ProductionRow,\n    DialogOverlay,\n    Disclosure,\n    DisclosureButton,\n    DisclosurePanel,\n    TransitionChild,\n    TransitionRoot,\n    SearchBar,\n    Icon,\n    FilterIcon,\n    XIcon,\n    PlusSmIcon,\n    MinusSmIcon,\n    Modal\n  },\n  computed: {\n    currentUser() {\n      return this.$store.getters.getCurrentUser;\n    },\n\n    paginated() {\n      return this.produits.slice(0, this.limit);\n    },\n\n    hasNextPage() {\n      return this.paginated.length < this.produits.length;\n    },\n\n    nbperpage() {\n      if (window.innerWidth >= 640 && window.innerWidth < 768) return 13;else if (window.innerWidth >= 768 && window.innerWidth < 1280) return 3 * 5;else if (window.innerWidth > 1280) return 4 * 5;else return 8;\n    },\n\n    pageNumber() {\n      let nb = this.productions.length / this.nbperpage;\n      if (this.productions.length % this.nbperpage != 0) nb++;\n      return parseInt(nb);\n    },\n\n    productions() {\n      return this.$store.getters.getProductions;\n    },\n\n    produits() {\n      return this.$store.getters.getProduits;\n    },\n\n    showedProductions() {\n      let start = (this.currentPage - 1) * this.nbperpage;\n      let end = start + this.nbperpage;\n      return this.productions.slice(start, end);\n    }\n\n  },\n  methods: {\n    searchfn: debounce(async function () {\n      console.log(this.search);\n      this.$store.dispatch(\"getProductions\", {\n        date: this.$refs.searchbar.search,\n        \"$Client.raisonSocial$\": this.$refs.searchbar.search\n      });\n    }, 500),\n\n    openCreateModal() {\n      this.$refs.createModal.open = true;\n    },\n\n    scrolllist(e) {\n      if (e.target.scrollHeight - e.target.scrollTop == e.target.clientHeight && this.hasNextPage) this.limit += 10;\n    },\n\n    async onOpen() {\n      if (this.hasNextPage) {\n        await this.$nextTick();\n        this.observer.observe(this.$refs.load);\n      }\n    },\n\n    onClose() {\n      this.observer.disconnect();\n    },\n\n    async infiniteScroll([{\n      isIntersecting,\n      target\n    }]) {\n      console.log(isIntersecting);\n\n      if (isIntersecting) {\n        const ul = target.offsetParent;\n        const scrollTop = target.offsetParent.scrollTop;\n        this.limit += 10;\n        await this.$nextTick();\n        ul.scrollTop = scrollTop;\n      }\n    },\n\n    addProd() {\n      this.$store.dispatch(\"addProduction\", { ...this.newProduction,\n        ProduitId: this.newProduction.Produit.id\n      });\n      this.$refs.createModal.open = false;\n      this.newProduction = {};\n    }\n\n  },\n  watch: {\n    etatsel: function () {\n      this.searchfn();\n    }\n  }\n};","map":{"version":3,"sources":["C:\\Users\\Dell\\Desktop\\vost-app\\src\\views\\produits\\Productions.vue"],"names":[],"mappings":"AA+WA,SAAS,QAAT,QAAyB,QAAzB;AACA,OAAO,UAAP,MAAuB,yBAAvB;AACA,OAAO,aAAP,MAA0B,4BAA1B;AACA,SACC,MADD,EAEC,aAFD,EAGC,UAHD,EAIC,gBAJD,EAKC,eALD,EAMC,eAND,EAOC,cAPD,EAQC,aARD,EASC,OATD,EAUC,cAVD,EAWC,aAXD,QAYO,iBAZP;AAaA,OAAO,SAAP,MAAsB,wBAAtB;AACA,SAAS,IAAT,QAAqB,cAArB;AACA,SAAS,UAAT,EAAqB,UAArB,EAAiC,WAAjC,QAAoD,sBAApD;AACA,SAAS,KAAT,QAAsB,wBAAtB;AACA,OAAO,KAAP,MAAkB,oBAAlB;AACA,eAAe;AACd,EAAA,IAAI,EAAE,aADQ;;AAEd,EAAA,WAAW,GAAG;AACb,SAAK,MAAL,CAAY,QAAZ,CAAqB,gBAArB;AACA,SAAK,MAAL,CAAY,QAAZ,CAAqB,aAArB;AACA,GALa;;AAMd,EAAA,IAAI,GAAG;AACN,WAAO;AACN,MAAA,iBAAiB,EAAE,KADb;AAEN,MAAA,WAAW,EAAE,CAFP;AAGN,MAAA,OAAO,EAAE,EAHH;AAIN,MAAA,aAAa,EAAE,EAJT;AAKN,MAAA,QAAQ,EAAE,IALJ;AAMN,MAAA,KAAK,EAAE;AAND,KAAP;AAQA,GAfa;;AAgBd,EAAA,OAAO,GAAG;AACT,SAAK,QAAL,GAAgB,IAAI,oBAAJ,CAAyB,KAAK,cAA9B,CAAhB;AACA,GAlBa;;AAmBd,EAAA,UAAU,EAAE;AACX,IAAA,aADW;AAEX,IAAA,OAFW;AAGX,IAAA,cAHW;AAIX,IAAA,aAJW;AAKX,IAAA,MALW;AAMX,IAAA,UANW;AAOX,IAAA,aAPW;AAQX,IAAA,aARW;AASX,IAAA,UATW;AAUX,IAAA,gBAVW;AAWX,IAAA,eAXW;AAYX,IAAA,eAZW;AAaX,IAAA,cAbW;AAcX,IAAA,SAdW;AAeX,IAAA,IAfW;AAgBX,IAAA,UAhBW;AAiBX,IAAA,KAjBW;AAkBX,IAAA,UAlBW;AAmBX,IAAA,WAnBW;AAoBX,IAAA;AApBW,GAnBE;AAyCd,EAAA,QAAQ,EAAE;AACT,IAAA,WAAW,GAAG;AACb,aAAO,KAAK,MAAL,CAAY,OAAZ,CAAoB,cAA3B;AACA,KAHQ;;AAIT,IAAA,SAAS,GAAG;AACX,aAAO,KAAK,QAAL,CAAc,KAAd,CAAoB,CAApB,EAAuB,KAAK,KAA5B,CAAP;AACA,KANQ;;AAOT,IAAA,WAAW,GAAG;AACb,aAAO,KAAK,SAAL,CAAe,MAAf,GAAwB,KAAK,QAAL,CAAc,MAA7C;AACA,KATQ;;AAUT,IAAA,SAAS,GAAG;AACX,UAAI,MAAM,CAAC,UAAP,IAAqB,GAArB,IAA4B,MAAM,CAAC,UAAP,GAAoB,GAApD,EAAyD,OAAO,EAAP,CAAzD,KACK,IAAI,MAAM,CAAC,UAAP,IAAqB,GAArB,IAA4B,MAAM,CAAC,UAAP,GAAoB,IAApD,EACJ,OAAO,IAAI,CAAX,CADI,KAEA,IAAI,MAAM,CAAC,UAAP,GAAoB,IAAxB,EAA8B,OAAO,IAAI,CAAX,CAA9B,KACA,OAAO,CAAP;AACL,KAhBQ;;AAiBT,IAAA,UAAU,GAAG;AACZ,UAAI,EAAC,GAAI,KAAK,WAAL,CAAiB,MAAjB,GAA0B,KAAK,SAAxC;AACA,UAAI,KAAK,WAAL,CAAiB,MAAjB,GAA0B,KAAK,SAA/B,IAA4C,CAAhD,EAAmD,EAAE;AACrD,aAAO,QAAQ,CAAC,EAAD,CAAf;AACA,KArBQ;;AAsBT,IAAA,WAAW,GAAG;AACb,aAAO,KAAK,MAAL,CAAY,OAAZ,CAAoB,cAA3B;AACA,KAxBQ;;AAyBT,IAAA,QAAQ,GAAG;AACV,aAAO,KAAK,MAAL,CAAY,OAAZ,CAAoB,WAA3B;AACA,KA3BQ;;AA4BT,IAAA,iBAAiB,GAAG;AACnB,UAAI,KAAI,GAAI,CAAC,KAAK,WAAL,GAAmB,CAApB,IAAyB,KAAK,SAA1C;AACA,UAAI,GAAE,GAAI,KAAI,GAAI,KAAK,SAAvB;AACA,aAAO,KAAK,WAAL,CAAiB,KAAjB,CAAuB,KAAvB,EAA8B,GAA9B,CAAP;AACA;;AAhCQ,GAzCI;AA2Ed,EAAA,OAAO,EAAE;AACR,IAAA,QAAQ,EAAE,QAAQ,CAAC,kBAAkB;AACpC,MAAA,OAAO,CAAC,GAAR,CAAY,KAAK,MAAjB;AACA,WAAK,MAAL,CAAY,QAAZ,CAAqB,gBAArB,EAAuC;AACtC,QAAA,IAAI,EAAE,KAAK,KAAL,CAAW,SAAX,CAAqB,MADW;AAEtC,iCAAyB,KAAK,KAAL,CAAW,SAAX,CAAqB;AAFR,OAAvC;AAIA,KANiB,EAMf,GANe,CADV;;AAQR,IAAA,eAAe,GAAG;AACjB,WAAK,KAAL,CAAW,WAAX,CAAuB,IAAvB,GAA8B,IAA9B;AACA,KAVO;;AAWR,IAAA,UAAU,CAAC,CAAD,EAAI;AACb,UACC,CAAC,CAAC,MAAF,CAAS,YAAT,GAAwB,CAAC,CAAC,MAAF,CAAS,SAAjC,IAA8C,CAAC,CAAC,MAAF,CAAS,YAAvD,IACA,KAAK,WAFN,EAIC,KAAK,KAAL,IAAc,EAAd;AACD,KAjBO;;AAkBR,UAAM,MAAN,GAAe;AACd,UAAI,KAAK,WAAT,EAAsB;AACrB,cAAM,KAAK,SAAL,EAAN;AACA,aAAK,QAAL,CAAc,OAAd,CAAsB,KAAK,KAAL,CAAW,IAAjC;AACD;AACA,KAvBO;;AAwBR,IAAA,OAAO,GAAG;AACT,WAAK,QAAL,CAAc,UAAd;AACA,KA1BO;;AA2BR,UAAM,cAAN,CAAqB,CAAC;AAAE,MAAA,cAAF;AAAkB,MAAA;AAAlB,KAAD,CAArB,EAAmD;AAClD,MAAA,OAAO,CAAC,GAAR,CAAY,cAAZ;;AACA,UAAI,cAAJ,EAAoB;AACnB,cAAM,EAAC,GAAI,MAAM,CAAC,YAAlB;AACA,cAAM,SAAQ,GAAI,MAAM,CAAC,YAAP,CAAoB,SAAtC;AACA,aAAK,KAAL,IAAc,EAAd;AACA,cAAM,KAAK,SAAL,EAAN;AACA,QAAA,EAAE,CAAC,SAAH,GAAe,SAAf;AACD;AACA,KApCO;;AAqCR,IAAA,OAAO,GAAG;AACT,WAAK,MAAL,CAAY,QAAZ,CAAqB,eAArB,EAAsC,EACrC,GAAG,KAAK,aAD6B;AAErC,QAAA,SAAS,EAAE,KAAK,aAAL,CAAmB,OAAnB,CAA2B;AAFD,OAAtC;AAIA,WAAK,KAAL,CAAW,WAAX,CAAuB,IAAvB,GAA8B,KAA9B;AACA,WAAK,aAAL,GAAqB,EAArB;AACA;;AA5CO,GA3EK;AAyHd,EAAA,KAAK,EAAE;AACN,IAAA,OAAO,EAAE,YAAY;AACpB,WAAK,QAAL;AACA;AAHK;AAzHO,CAAf","sourcesContent":["<template>\r\n\t<div\r\n\t\tclass=\"flex flex-col w-full justify-center items-center h-full bg-gray-700 overflow-hidden\"\r\n\t>\r\n\t\t<div class=\"flex self-start w-full items-center space-x-3 h-16 py-1 px-2\">\r\n\t\t\t<SearchBar ref=\"searchbar\" @search=\"searchfn\" />\r\n\t\t\t<div\r\n\t\t\t\tclass=\"rounded-full py-2 px-2 bg-gray-500\"\r\n\t\t\t\t:class=\"{ hidden: refs?.searchbar?.open }\"\r\n\t\t\t>\r\n\t\t\t\t<FilterIcon\r\n\t\t\t\t\t@click=\"mobileFiltersOpen = !mobileFiltersOpen\"\r\n\t\t\t\t\tclass=\"h-7 fill-current text-white\"\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t\t<div\r\n\t\t\t\tclass=\"rounded-full py-2 px-2 bg-gray-500\"\r\n\t\t\t\tv-if=\"\r\n\t\t\t\t\tcurrentUser.Profile.Autorisations.find(\r\n\t\t\t\t\t\t(el) => el.nom == 'add-production'\r\n\t\t\t\t\t)\r\n\t\t\t\t\"\r\n\t\t\t>\r\n\t\t\t\t<Icon\r\n\t\t\t\t\ticon=\"ion:create\"\r\n\t\t\t\t\t@click=\"openCreateModal\"\r\n\t\t\t\t\tclass=\"h-7 w-7 fill-current text-white\"\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"bg-blue-900\">\r\n\t\t\t<div>\r\n\t\t\t\t<!-- Mobile filter dialog -->\r\n\t\t\t\t<TransitionRoot as=\"template\" :show=\"mobileFiltersOpen\">\r\n\t\t\t\t\t<Dialog\r\n\t\t\t\t\t\tas=\"div\"\r\n\t\t\t\t\t\tclass=\"fixed inset-0 flex z-40\"\r\n\t\t\t\t\t\t@close=\"mobileFiltersOpen = false\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<TransitionChild\r\n\t\t\t\t\t\t\tas=\"template\"\r\n\t\t\t\t\t\t\tenter=\"transition-opacity ease-linear duration-300\"\r\n\t\t\t\t\t\t\tenter-from=\"opacity-0\"\r\n\t\t\t\t\t\t\tenter-to=\"opacity-100\"\r\n\t\t\t\t\t\t\tleave=\"transition-opacity ease-linear duration-300\"\r\n\t\t\t\t\t\t\tleave-from=\"opacity-100\"\r\n\t\t\t\t\t\t\tleave-to=\"opacity-0\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<DialogOverlay class=\"fixed inset-0 bg-black bg-opacity-25\" />\r\n\t\t\t\t\t\t</TransitionChild>\r\n\r\n\t\t\t\t\t\t<TransitionChild\r\n\t\t\t\t\t\t\tas=\"template\"\r\n\t\t\t\t\t\t\tenter=\"transition ease-in-out duration-300 transform\"\r\n\t\t\t\t\t\t\tenter-from=\"translate-x-full\"\r\n\t\t\t\t\t\t\tenter-to=\"translate-x-0\"\r\n\t\t\t\t\t\t\tleave=\"transition ease-in-out duration-300 transform\"\r\n\t\t\t\t\t\t\tleave-from=\"translate-x-0\"\r\n\t\t\t\t\t\t\tleave-to=\"translate-x-full\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tclass=\"ml-auto relative max-w-xs w-full h-full bg-gray-900 shadow-xl py-4 pb-12 flex flex-col overflow-y-auto\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<div class=\"px-4 flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t<h2 class=\"text-lg font-medium text-gray-300\">Filters</h2>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\tclass=\"-mr-2 w-7 h-7 bg-gray-800 p-1 rounded-md flex items-center justify-center text-gray-400\"\r\n\t\t\t\t\t\t\t\t\t\t@click=\"mobileFiltersOpen = false\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"sr-only text-white\">Close menu</span>\r\n\t\t\t\t\t\t\t\t\t\t<XIcon class=\"h-6 w-6 text-gray-300\" aria-hidden=\"true\" />\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<Disclosure\r\n\t\t\t\t\t\t\t\t\tas=\"div\"\r\n\t\t\t\t\t\t\t\t\tclass=\"border-t border-gray-400 px-4 py-6\"\r\n\t\t\t\t\t\t\t\t\tv-slot=\"{ open }\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<h3 class=\"-mx-2 -my-3 flow-root\">\r\n\t\t\t\t\t\t\t\t\t\t<DisclosureButton as=\"template\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"px-2 py-3 bg-gray-700 w-full flex items-center justify-between text-gray-400 hover:text-gray-200\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"font-medium text-gray-400\"> Etat </span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"ml-6 flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<PlusSmIcon\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv-if=\"!open\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-5 w-5\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<MinusSmIcon\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv-else\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-5 w-5\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</DisclosureButton>\r\n\t\t\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t\t\t<DisclosurePanel class=\"pt-6\">\r\n\t\t\t\t\t\t\t\t\t\t<div class=\"space-y-6\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue=\"en attente\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-4 w-4 border-gray-400 rounded text-blue-600 focus:ring-blue-500\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tv-model=\"etatsel\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"ml-3 min-w-0 flex-1 text-gray-500\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tEn attente\r\n\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue=\"valide\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-4 w-4 border-gray-400 rounded text-blue-600 focus:ring-blue-500\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tv-model=\"etatsel\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"ml-3 min-w-0 flex-1 text-gray-500\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tValidé\r\n\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</DisclosurePanel>\r\n\t\t\t\t\t\t\t\t</Disclosure>\r\n\t\t\t\t\t\t\t\t<Disclosure\r\n\t\t\t\t\t\t\t\t\tas=\"div\"\r\n\t\t\t\t\t\t\t\t\tclass=\"border-t border-gray-400 px-4 py-6\"\r\n\t\t\t\t\t\t\t\t\tv-slot=\"{ open }\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<h3 class=\"-mx-2 -my-3 flow-root\">\r\n\t\t\t\t\t\t\t\t\t\t<DisclosureButton as=\"template\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"px-2 py-3 bg-gray-700 w-full flex items-center justify-between text-gray-400 hover:text-gray-200\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"font-medium text-gray-400\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tCouleurs\r\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"ml-6 flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<PlusSmIcon\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv-if=\"!open\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-5 w-5\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<MinusSmIcon\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv-else\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-5 w-5\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</DisclosureButton>\r\n\t\t\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t\t\t<DisclosurePanel class=\"pt-6\">\r\n\t\t\t\t\t\t\t\t\t\t<div v-if=\"couleurs.length > 0\" class=\"space-y-6\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\t\t\tv-for=\"couleur in couleurs\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t:key=\"couleur.id\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"flex items-center\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t:value=\"couleur.id\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t:checked=\"couleur.checked\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-4 w-4 border-gray-400 rounded\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t:style=\"{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'--tw-ring-color': `#${couleur.code}`,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcolor: `#${couleur.code}`,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tv-model=\"couleursel\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<label\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"ml-3 min-w-0 flex-1\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t:style=\"{ color: `#${couleur.code}` }\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{ couleur.nom }}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</DisclosurePanel>\r\n\t\t\t\t\t\t\t\t</Disclosure>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</TransitionChild>\r\n\t\t\t\t\t</Dialog>\r\n\t\t\t\t</TransitionRoot>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"flex-1 flex flex-col h-full w-full overflow-hidden\">\r\n\t\t\t<div\r\n\t\t\t\tclass=\"h-full md:justify-center aligned-center w-full flex flex-1 flex-col overflow-auto overflow-x-hidden py-3\"\r\n\t\t\t>\r\n\t\t\t\t<table\r\n\t\t\t\t\tclass=\"bg-white rounded-md mx-1 grid grid-flow-row overflow-hidden text-black my-auto\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t<tr class=\"w-full grid grid-flow-col\">\r\n\t\t\t\t\t\t\t<th class=\"px-2 py-2 col-span-1\">Produit</th>\r\n\t\t\t\t\t\t\t<th class=\"px-4 py-2 col-span-1\">User</th>\r\n\t\t\t\t\t\t\t<th class=\"px-4 py-2 col-span-1\">Quantité</th>\r\n\t\t\t\t\t\t\t<th class=\"px-4 py-2 col-span-1\">Date</th>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</thead>\r\n\t\t\t\t\t<tbody class=\"w-full grid grid-flow-row overflow-auto\">\r\n\t\t\t\t\t\t<ProductionRow\r\n\t\t\t\t\t\t\tv-for=\"production in showedProductions\"\r\n\t\t\t\t\t\t\t:key=\"production.id\"\r\n\t\t\t\t\t\t\t:production=\"production\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</tbody>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t\t<Pagination\r\n\t\t\t\tref=\"Pagination\"\r\n\t\t\t\t:currentPage=\"currentPage\"\r\n\t\t\t\t:pageSize=\"nbperpage\"\r\n\t\t\t\t:dataLength=\"productions.length\"\r\n\t\t\t\t@page=\"currentPage = $event\"\r\n\t\t\t\t@next=\"currentPage++\"\r\n\t\t\t\t@prev=\"currentPage--\"\r\n\t\t\t\t@first=\"currentPage = 1\"\r\n\t\t\t\t@last=\"currentPage = $refs.Pagination.pageNumber\"\r\n\t\t\t/>\r\n\t\t</div>\r\n\t\t<Modal ref=\"createModal\" @submit=\"addProd\">\r\n\t\t\t<template v-slot:title>Ajouter un produit</template>\r\n\t\t\t<template v-slot:body>\r\n\t\t\t\t<div class=\"flex flex-col w-full pb-12 overflow-y-auto\">\r\n\t\t\t\t\t<div class=\"flex flex-col space-y-3 mt-4 px-2\">\r\n\t\t\t\t\t\t<div class=\"flex flex-col w-full\">\r\n\t\t\t\t\t\t\t<div class=\"flex flex-col items-start space-y-2 space-x-2 w-full\">\r\n\t\t\t\t\t\t\t\t<label\r\n\t\t\t\t\t\t\t\t\tfor=\"nom\"\r\n\t\t\t\t\t\t\t\t\tclass=\"flex items-center text-bold h-full rounded-l-md text-md\"\r\n\t\t\t\t\t\t\t\t\t>Lot</label\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\t\tname=\"lot\"\r\n\t\t\t\t\t\t\t\t\tid=\"lot\"\r\n\t\t\t\t\t\t\t\t\tv-model=\"newProduction.lot\"\r\n\t\t\t\t\t\t\t\t\tplaceholder=\"Lot\"\r\n\t\t\t\t\t\t\t\t\tclass=\"rounded-md border-0 w-3/4\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"flex flex-col w-full\">\r\n\t\t\t\t\t\t\t<div class=\"flex flex-col items-start w-full space-y-2 space-x-2\">\r\n\t\t\t\t\t\t\t\t<label\r\n\t\t\t\t\t\t\t\t\tfor=\"passwordConfirm\"\r\n\t\t\t\t\t\t\t\t\tclass=\"flex items-center text-bold h-full rounded-l-md text-md\"\r\n\t\t\t\t\t\t\t\t\t>Produit</label\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<Listbox v-model=\"newProduction.Produit\">\r\n\t\t\t\t\t\t\t\t\t<div class=\"relative w-11/12\">\r\n\t\t\t\t\t\t\t\t\t\t<ListboxButton\r\n\t\t\t\t\t\t\t\t\t\t\t@focus=\"onOpen\"\r\n\t\t\t\t\t\t\t\t\t\t\t@blur=\"onClose\"\r\n\t\t\t\t\t\t\t\t\t\t\tclass=\"h-10 relative w-full py-2 pl-3 pr-10 text-left bg-white rounded-lg shadow-md cursor-default focus:outline-none focus-visible:ring-2 focus-visible:ring-opacity-75 focus-visible:ring-white focus-visible:ring-offset-orange-300 focus-visible:ring-offset-2 focus-visible:border-indigo-500 sm:text-sm\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"block truncate\">{{\r\n\t\t\t\t\t\t\t\t\t\t\t\tnewProduction.Produit?.nom || \"Produits...\"\r\n\t\t\t\t\t\t\t\t\t\t\t}}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<SelectorIcon\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-5 h-5 text-gray-400\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t</ListboxButton>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<transition\r\n\t\t\t\t\t\t\t\t\t\t\tleave-active-class=\"transition duration-100 ease-in\"\r\n\t\t\t\t\t\t\t\t\t\t\tleave-from-class=\"opacity-100\"\r\n\t\t\t\t\t\t\t\t\t\t\tleave-to-class=\"opacity-0\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<ListboxOptions\r\n\t\t\t\t\t\t\t\t\t\t\t\t@scroll=\"scrolllist\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"absolute w-full max-h-48 py-1 mt-1 overflow-auto text-base bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm z-50\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<ListboxOption\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tv-slot=\"{ active, selected }\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tv-for=\"product in paginated\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t:key=\"product.id\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t:value=\"product\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tas=\"template\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<li\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t:class=\"[\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tactive\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'text-amber-900 bg-amber-100'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'text-gray-900',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'cursor-default select-none relative py-2 px-4',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t]\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t:class=\"[\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselected ? 'font-medium' : 'font-normal',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'block truncate',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>{{ product.nom }} ({{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tproduct.contenance\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}kg)</span\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv-if=\"selected\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"absolute inset-y-0 left-0 flex items-center pl-3 text-amber-600\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<CheckIcon class=\"w-5 h-5\" aria-hidden=\"true\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</ListboxOption>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<ListboxOption v-show=\"hasNextPage\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span ref=\"load\"> loading</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</ListboxOption>\r\n\t\t\t\t\t\t\t\t\t\t\t</ListboxOptions>\r\n\t\t\t\t\t\t\t\t\t\t</transition>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</Listbox>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"flex flex-col w-full\">\r\n\t\t\t\t\t\t\t<div class=\"flex flex-col items-start w-full space-y-2 space-x-2\">\r\n\t\t\t\t\t\t\t\t<label\r\n\t\t\t\t\t\t\t\t\tfor=\"quantite\"\r\n\t\t\t\t\t\t\t\t\tclass=\"flex items-center text-bold h-full rounded-l-md px-2text-xl\"\r\n\t\t\t\t\t\t\t\t\t>Quantite</label\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\t\t\t\t\tname=\"quantite\"\r\n\t\t\t\t\t\t\t\t\tid=\"quantite\"\r\n\t\t\t\t\t\t\t\t\tv-model=\"newProduction.quantite\"\r\n\t\t\t\t\t\t\t\t\tplaceholder=\"Quantité\"\r\n\t\t\t\t\t\t\t\t\tclass=\"rounded-md border-0 w-3/4\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"flex flex-col w-full\">\r\n\t\t\t\t\t\t\t<div class=\"flex flex-col items-start w-full space-y-2 space-x-2\">\r\n\t\t\t\t\t\t\t\t<label\r\n\t\t\t\t\t\t\t\t\tfor=\"date\"\r\n\t\t\t\t\t\t\t\t\tclass=\"flex items-center text-bold h-full rounded-l-md px-2text-xl\"\r\n\t\t\t\t\t\t\t\t\t>Date Production</label\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\ttype=\"date\"\r\n\t\t\t\t\t\t\t\t\tname=\"date\"\r\n\t\t\t\t\t\t\t\t\tid=\"date\"\r\n\t\t\t\t\t\t\t\t\tv-model=\"newProduction.date\"\r\n\t\t\t\t\t\t\t\t\tplaceholder=\"Date de production\"\r\n\t\t\t\t\t\t\t\t\tclass=\"rounded-md border-0 w-3/4\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</template>\r\n\t\t\t<template v-slot:submit>Ajouter</template>\r\n\t\t</Modal>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\nimport { debounce } from \"lodash\";\r\nimport Pagination from \"@/components/Pagination\";\r\nimport ProductionRow from \"@/components/ProductionRow\";\r\nimport {\r\n\tDialog,\r\n\tDialogOverlay,\r\n\tDisclosure,\r\n\tDisclosureButton,\r\n\tDisclosurePanel,\r\n\tTransitionChild,\r\n\tTransitionRoot,\r\n\tListboxButton,\r\n\tListbox,\r\n\tListboxOptions,\r\n\tListboxOption,\r\n} from \"@headlessui/vue\";\r\nimport SearchBar from \"@/components/SearchBar\";\r\nimport { Icon } from \"@iconify/vue\";\r\nimport { FilterIcon, PlusSmIcon, MinusSmIcon } from \"@heroicons/vue/solid\";\r\nimport { XIcon } from \"@heroicons/vue/outline\";\r\nimport Modal from \"@/components/Modal\";\r\nexport default {\r\n\tname: \"Productions\",\r\n\tbeforeMount() {\r\n\t\tthis.$store.dispatch(\"getProductions\");\r\n\t\tthis.$store.dispatch(\"getProduits\");\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tmobileFiltersOpen: false,\r\n\t\t\tcurrentPage: 1,\r\n\t\t\tetatsel: [],\r\n\t\t\tnewProduction: {},\r\n\t\t\tobserver: null,\r\n\t\t\tlimit: 10,\r\n\t\t};\r\n\t},\r\n\tmounted() {\r\n\t\tthis.observer = new IntersectionObserver(this.infiniteScroll);\r\n\t},\r\n\tcomponents: {\r\n\t\tListboxButton,\r\n\t\tListbox,\r\n\t\tListboxOptions,\r\n\t\tListboxOption,\r\n\t\tDialog,\r\n\t\tPagination,\r\n\t\tProductionRow,\r\n\t\tDialogOverlay,\r\n\t\tDisclosure,\r\n\t\tDisclosureButton,\r\n\t\tDisclosurePanel,\r\n\t\tTransitionChild,\r\n\t\tTransitionRoot,\r\n\t\tSearchBar,\r\n\t\tIcon,\r\n\t\tFilterIcon,\r\n\t\tXIcon,\r\n\t\tPlusSmIcon,\r\n\t\tMinusSmIcon,\r\n\t\tModal,\r\n\t},\r\n\tcomputed: {\r\n\t\tcurrentUser() {\r\n\t\t\treturn this.$store.getters.getCurrentUser;\r\n\t\t},\r\n\t\tpaginated() {\r\n\t\t\treturn this.produits.slice(0, this.limit);\r\n\t\t},\r\n\t\thasNextPage() {\r\n\t\t\treturn this.paginated.length < this.produits.length;\r\n\t\t},\r\n\t\tnbperpage() {\r\n\t\t\tif (window.innerWidth >= 640 && window.innerWidth < 768) return 13;\r\n\t\t\telse if (window.innerWidth >= 768 && window.innerWidth < 1280)\r\n\t\t\t\treturn 3 * 5;\r\n\t\t\telse if (window.innerWidth > 1280) return 4 * 5;\r\n\t\t\telse return 8;\r\n\t\t},\r\n\t\tpageNumber() {\r\n\t\t\tlet nb = this.productions.length / this.nbperpage;\r\n\t\t\tif (this.productions.length % this.nbperpage != 0) nb++;\r\n\t\t\treturn parseInt(nb);\r\n\t\t},\r\n\t\tproductions() {\r\n\t\t\treturn this.$store.getters.getProductions;\r\n\t\t},\r\n\t\tproduits() {\r\n\t\t\treturn this.$store.getters.getProduits;\r\n\t\t},\r\n\t\tshowedProductions() {\r\n\t\t\tlet start = (this.currentPage - 1) * this.nbperpage;\r\n\t\t\tlet end = start + this.nbperpage;\r\n\t\t\treturn this.productions.slice(start, end);\r\n\t\t},\r\n\t},\r\n\tmethods: {\r\n\t\tsearchfn: debounce(async function () {\r\n\t\t\tconsole.log(this.search);\r\n\t\t\tthis.$store.dispatch(\"getProductions\", {\r\n\t\t\t\tdate: this.$refs.searchbar.search,\r\n\t\t\t\t\"$Client.raisonSocial$\": this.$refs.searchbar.search,\r\n\t\t\t});\r\n\t\t}, 500),\r\n\t\topenCreateModal() {\r\n\t\t\tthis.$refs.createModal.open = true;\r\n\t\t},\r\n\t\tscrolllist(e) {\r\n\t\t\tif (\r\n\t\t\t\te.target.scrollHeight - e.target.scrollTop == e.target.clientHeight &&\r\n\t\t\t\tthis.hasNextPage\r\n\t\t\t)\r\n\t\t\t\tthis.limit += 10;\r\n\t\t},\r\n\t\tasync onOpen() {\r\n\t\t\tif (this.hasNextPage) {\r\n\t\t\t\tawait this.$nextTick();\r\n\t\t\t\tthis.observer.observe(this.$refs.load);\r\n\t\t\t}\r\n\t\t},\r\n\t\tonClose() {\r\n\t\t\tthis.observer.disconnect();\r\n\t\t},\r\n\t\tasync infiniteScroll([{ isIntersecting, target }]) {\r\n\t\t\tconsole.log(isIntersecting);\r\n\t\t\tif (isIntersecting) {\r\n\t\t\t\tconst ul = target.offsetParent;\r\n\t\t\t\tconst scrollTop = target.offsetParent.scrollTop;\r\n\t\t\t\tthis.limit += 10;\r\n\t\t\t\tawait this.$nextTick();\r\n\t\t\t\tul.scrollTop = scrollTop;\r\n\t\t\t}\r\n\t\t},\r\n\t\taddProd() {\r\n\t\t\tthis.$store.dispatch(\"addProduction\", {\r\n\t\t\t\t...this.newProduction,\r\n\t\t\t\tProduitId: this.newProduction.Produit.id,\r\n\t\t\t});\r\n\t\t\tthis.$refs.createModal.open = false;\r\n\t\t\tthis.newProduction = {};\r\n\t\t},\r\n\t},\r\n\twatch: {\r\n\t\tetatsel: function () {\r\n\t\t\tthis.searchfn();\r\n\t\t},\r\n\t},\r\n};\r\n</script>\r\n\r\n<style></style>\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}