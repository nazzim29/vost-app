{"ast":null,"code":"import { createRouter, createWebHistory } from \"vue-router\";\nimport store from \"../store\";\n\nfunction loadView(view) {\n  return () => import(`../views/${view}.vue`);\n}\n\nconst routes = [{\n  path: \"/\",\n  name: \"Home\",\n  component: loadView(\"Home\"),\n  meta: {\n    auth: true\n  }\n}, {\n  path: \"/parametres\",\n  name: \"Parametres\",\n  component: loadView(\"Parametres\"),\n  meta: {\n    auth: true,\n    role: \"admin\"\n  }\n}, {\n  path: \"/login\",\n  name: \"Login\",\n  component: loadView(\"user/Login\"),\n  meta: {\n    auth: false\n  }\n}, {\n  path: \"/user\",\n  name: \"User\",\n  component: loadView(\"user/UsersIndex\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-utilisateur\"\n  }\n}, // {\n// \tpath: \"/user/new\",\n// \tname: \"NewUser\",\n// \tcomponent: loadView(\"user/NewUser\"),\n// \tmeta: {\n// \t\tauth: true,\n// \t}\n// },\n// {\n// \tpath: \"/user/:id\",\n// \tname: \"UserProfile\",\n// \tcomponent: loadView(\"user/UsersIndex\"),\n// \tmeta: {\n// \t\tauth:true,\n// \t}\n// },\n// {\n// \tpath: \"/user/edit/:id\",\n// \tname: \"UserEdit\",\n// \tcomponent: loadView(\"user/NewUser\"),\n// \tmeta: {\n// \t\tauth: true,\n// \t}\n// },\n// {\n// \tpath: \"/me\",\n// \tname: \"Profile\",\n// \tcomponent: loadView(\"user/Profile\"),\n// \tmeta: {\n// \t\tauth: true,\n// \t}\n// },\n{\n  path: \"/fonction\",\n  name: \"Fonction\",\n  component: loadView(\"user/Fonction\"),\n  meta: {\n    auth: true,\n    role: \"admin\"\n  }\n}, {\n  path: \"/commandes\",\n  name: \"Commandes\",\n  component: loadView(\"commandes/Commandes\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-commande\"\n  }\n}, {\n  path: \"/commandes/:id\",\n  name: \"Commande\",\n  component: loadView(\"commandes/CommandeShow\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-commande\"\n  }\n}, {\n  path: \"/produits\",\n  name: \"Produits\",\n  component: loadView(\"produits/Produits\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-produit\"\n  }\n}, {\n  path: \"/productions\",\n  name: \"Productions\",\n  component: loadView(\"produits/Productions\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-production\"\n  }\n}, {\n  path: \"/MatierePremiere\",\n  name: \"MatierePremiere\",\n  component: loadView(\"produits/MatierePremiere\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-matiere\"\n  }\n}, // {\n// \tpath: \"/Formules\",\n// \tname: \"Formules\",\n// \tcomponent: loadView(\"produits/Formules\"),\n// \tmeta: {\n// \t\tauth: true,\n// \t}\n// },\n// {\n// \tpath: \"/messagerie\",\n// \tname: \"messagerie\",\n// \tcomponent: loadView(\"Messagerie\"),\n// \tmeta: {\n// \t\tauth: true,\n// \t}\n// },\n{\n  path: \"/contact-client\",\n  name: \"ContactClient\",\n  component: loadView(\"client/ContactClient\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-contactclient\"\n  }\n}, {\n  path: \"/Ventes/:id\",\n  name: \"Vente\",\n  component: loadView(\"vente/VenteShow\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-vente\"\n  }\n}, {\n  path: \"/Ventes\",\n  name: \"Ventes\",\n  component: loadView(\"vente/Ventes\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-vente\"\n  }\n}, {\n  path: \"/clients\",\n  name: \"Clients\",\n  component: loadView(\"client/Client\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-client\"\n  }\n}, {\n  path: \"/clients/:id\",\n  name: \"ClientShow\",\n  component: loadView(\"client/ClientShow\"),\n  meta: {\n    auth: true,\n    autorisation: \"read-client\"\n  }\n}];\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\nlet interval = null;\n\nasync function checklogin() {\n  if (store.getters.isAuth) {\n    if (!interval) {\n      interval = setInterval(async () => {\n        await store.dispatch(\"checkAuth\");\n      }, 5000);\n    }\n\n    return true;\n  } else {\n    return false;\n  }\n}\n\nrouter.beforeEach(async function (to, from, next) {\n  console.log();\n  let isLogged = await checklogin(); //if to.auth is true and user is not logged in\n\n  if (to.meta.auth && !isLogged) {\n    console.log(\"not logged in\");\n    return next({\n      name: \"Login\"\n    });\n  } else if (to.meta.auth && isLogged) {\n    console.log(\"logged in\");\n\n    if (to.meta.role) {\n      if (store.getters.getCurrentUser.Profile.nom === to.meta.role) {\n        return next();\n      } else {\n        console.log(\"not authorized (role)\");\n        return next(\"/\");\n      }\n    } else if (to.meta.autorisation) {\n      if (store.getters.getCurrentUser.Profile.Autorisations.find(el => el.nom == to.meta.autorisation)) {\n        return next();\n      } else {\n        console.log(\"not authorized (autorisation)\");\n        return next(\"/\");\n      }\n    }\n  }\n\n  return next(); // if (\n  // \tto.meta.auth === true\n  // ) {\n  // \tif (isLogged && (to.meta.role == store.getters.getCurrentUser.Profile.nom ||\n  // \t\tstore.getters.getCurrentUser.Profile.Autorisations.find(\n  // \t\t\t(el) => el.nom == to.meta.autorisation\n  // \t\t))) next();\n  // \telse next(\"/\");\n  // } else if (to.meta.auth === false) {\n  // \tif (isLogged) next(from);\n  // \telse next();\n  // }\n});\nexport default function (app) {\n  app.router = router;\n  app.use(router);\n}","map":{"version":3,"sources":["C:/Users/Dell/Desktop/vost-app/src/router/index.js"],"names":["createRouter","createWebHistory","store","loadView","view","routes","path","name","component","meta","auth","role","autorisation","router","history","process","env","BASE_URL","interval","checklogin","getters","isAuth","setInterval","dispatch","beforeEach","to","from","next","console","log","isLogged","getCurrentUser","Profile","nom","Autorisations","find","el","app","use"],"mappings":"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","sourcesContent":["import { createRouter, createWebHistory } from \"vue-router\";\r\nimport store from \"../store\";\r\n\r\nfunction loadView(view) {\r\n\treturn () => import(`../views/${view}.vue`);\r\n}\r\n\r\nconst routes = [\r\n\t{\r\n\t\tpath: \"/\",\r\n\t\tname: \"Home\",\r\n\t\tcomponent: loadView(\"Home\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tpath: \"/parametres\",\r\n\t\tname: \"Parametres\",\r\n\t\tcomponent: loadView(\"Parametres\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t\trole: \"admin\",\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tpath: \"/login\",\r\n\t\tname: \"Login\",\r\n\t\tcomponent: loadView(\"user/Login\"),\r\n\t\tmeta: {\r\n\t\t\tauth: false,\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tpath: \"/user\",\r\n\t\tname: \"User\",\r\n\t\tcomponent: loadView(\"user/UsersIndex\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t\tautorisation: \"read-utilisateur\",\r\n\t\t},\r\n\t},\r\n\t// {\r\n\t// \tpath: \"/user/new\",\r\n\t// \tname: \"NewUser\",\r\n\t// \tcomponent: loadView(\"user/NewUser\"),\r\n\t// \tmeta: {\r\n\t// \t\tauth: true,\r\n\r\n\t// \t}\r\n\t// },\r\n\t// {\r\n\t// \tpath: \"/user/:id\",\r\n\t// \tname: \"UserProfile\",\r\n\t// \tcomponent: loadView(\"user/UsersIndex\"),\r\n\t// \tmeta: {\r\n\t// \t\tauth:true,\r\n\t// \t}\r\n\t// },\r\n\t// {\r\n\t// \tpath: \"/user/edit/:id\",\r\n\t// \tname: \"UserEdit\",\r\n\t// \tcomponent: loadView(\"user/NewUser\"),\r\n\t// \tmeta: {\r\n\t// \t\tauth: true,\r\n\t// \t}\r\n\t// },\r\n\t// {\r\n\t// \tpath: \"/me\",\r\n\t// \tname: \"Profile\",\r\n\t// \tcomponent: loadView(\"user/Profile\"),\r\n\t// \tmeta: {\r\n\t// \t\tauth: true,\r\n\t// \t}\r\n\t// },\r\n\t{\r\n\t\tpath: \"/fonction\",\r\n\t\tname: \"Fonction\",\r\n\t\tcomponent: loadView(\"user/Fonction\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t\trole: \"admin\",\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tpath: \"/commandes\",\r\n\t\tname: \"Commandes\",\r\n\t\tcomponent: loadView(\"commandes/Commandes\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t\tautorisation: \"read-commande\",\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tpath: \"/commandes/:id\",\r\n\t\tname: \"Commande\",\r\n\t\tcomponent: loadView(\"commandes/CommandeShow\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t\tautorisation: \"read-commande\",\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tpath: \"/produits\",\r\n\t\tname: \"Produits\",\r\n\t\tcomponent: loadView(\"produits/Produits\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t\tautorisation: \"read-produit\",\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tpath: \"/productions\",\r\n\t\tname: \"Productions\",\r\n\t\tcomponent: loadView(\"produits/Productions\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t\tautorisation: \"read-production\",\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tpath: \"/MatierePremiere\",\r\n\t\tname: \"MatierePremiere\",\r\n\t\tcomponent: loadView(\"produits/MatierePremiere\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t\tautorisation: \"read-matiere\",\r\n\t\t},\r\n\t},\r\n\t// {\r\n\t// \tpath: \"/Formules\",\r\n\t// \tname: \"Formules\",\r\n\t// \tcomponent: loadView(\"produits/Formules\"),\r\n\t// \tmeta: {\r\n\t// \t\tauth: true,\r\n\r\n\t// \t}\r\n\t// },\r\n\t// {\r\n\t// \tpath: \"/messagerie\",\r\n\t// \tname: \"messagerie\",\r\n\t// \tcomponent: loadView(\"Messagerie\"),\r\n\t// \tmeta: {\r\n\t// \t\tauth: true,\r\n\t// \t}\r\n\t// },\r\n\t{\r\n\t\tpath: \"/contact-client\",\r\n\t\tname: \"ContactClient\",\r\n\t\tcomponent: loadView(\"client/ContactClient\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t\tautorisation: \"read-contactclient\",\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tpath: \"/Ventes/:id\",\r\n\t\tname: \"Vente\",\r\n\t\tcomponent: loadView(\"vente/VenteShow\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t\tautorisation: \"read-vente\",\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tpath: \"/Ventes\",\r\n\t\tname: \"Ventes\",\r\n\t\tcomponent: loadView(\"vente/Ventes\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t\tautorisation: \"read-vente\",\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tpath: \"/clients\",\r\n\t\tname: \"Clients\",\r\n\t\tcomponent: loadView(\"client/Client\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t\tautorisation: \"read-client\",\r\n\t\t},\r\n\t},\r\n\t{\r\n\t\tpath: \"/clients/:id\",\r\n\t\tname: \"ClientShow\",\r\n\t\tcomponent: loadView(\"client/ClientShow\"),\r\n\t\tmeta: {\r\n\t\t\tauth: true,\r\n\t\t\tautorisation: \"read-client\",\r\n\t\t},\r\n\t},\r\n];\r\n\r\nconst router = createRouter({\r\n\thistory: createWebHistory(process.env.BASE_URL),\r\n\troutes,\r\n});\r\nlet interval = null;\r\nasync function checklogin() {\r\n\tif (store.getters.isAuth) {\r\n\t\tif (!interval) {\r\n\t\t\tinterval = setInterval(async () => {\r\n\t\t\t\tawait store.dispatch(\"checkAuth\");\r\n\t\t\t}, 5000);\r\n\t\t}\r\n\t\treturn true;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\nrouter.beforeEach(async function (to, from, next) {\r\n\tconsole.log();\r\n\tlet isLogged = await checklogin();\r\n\t//if to.auth is true and user is not logged in\r\n\tif (to.meta.auth && !isLogged) {\r\n\t\tconsole.log(\"not logged in\");\r\n\t\treturn next({\r\n\t\t\tname: \"Login\",\r\n\t\t});\r\n\t} else if (to.meta.auth && isLogged) {\r\n\t\tconsole.log(\"logged in\");\r\n\t\tif (to.meta.role) {\r\n\t\t\tif (store.getters.getCurrentUser.Profile.nom === to.meta.role) {\r\n\t\t\t\treturn next();\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"not authorized (role)\");\r\n\t\t\t\treturn next(\"/\");\r\n\t\t\t}\r\n\t\t} else if (to.meta.autorisation) {\r\n\t\t\tif (store.getters.getCurrentUser.Profile.Autorisations.find(el => el.nom == to.meta.autorisation)) {\r\n\t\t\t\treturn next();\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"not authorized (autorisation)\");\r\n\t\t\t\treturn next(\"/\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn next()\r\n\t// if (\r\n\t// \tto.meta.auth === true\r\n\t// ) {\r\n\t// \tif (isLogged && (to.meta.role == store.getters.getCurrentUser.Profile.nom ||\r\n\t// \t\tstore.getters.getCurrentUser.Profile.Autorisations.find(\r\n\t// \t\t\t(el) => el.nom == to.meta.autorisation\r\n\t// \t\t))) next();\r\n\t// \telse next(\"/\");\r\n\t// } else if (to.meta.auth === false) {\r\n\t// \tif (isLogged) next(from);\r\n\t// \telse next();\r\n\t// }\r\n});\r\nexport default function (app) {\r\n\tapp.router = router;\r\n\tapp.use(router);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}